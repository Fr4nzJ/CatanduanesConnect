{% extends "_layout.html" %}

{% block main_content %}
<div class="businesses-container">
    <h1 class="page-title">Local Businesses</h1>

    <!-- Search and Filter -->
    <div class="search-filter-container">
        <form class="search-form">
            <input type="text" name="search" placeholder="Search businesses..." class="form-control">
            <select name="category" class="form-control">
                <option value="">All Categories</option>
                {% for category in categories %}
                <option value="{{ category }}">{{ category }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>

    <!-- Map View Toggle -->
    <div class="view-toggle">
        <a href="{{ url_for('guest.view_businesses_map') }}" class="btn btn-outline-primary">
            <i class="fas fa-map-marker-alt"></i> View on Map
        </a>
    </div>

    <!-- Businesses Grid -->
    <div class="businesses-grid">
        {% for business in businesses %}
        <div class="business-card">
            <div class="business-header">
                {% if business.logo_url %}
                <img src="{{ business.logo_url }}" alt="{{ business.name|default('Unnamed Business', true) }}" class="business-logo">
                {% else %}
                <div class="business-logo-placeholder">
                    {{ business.name|default('Unnamed Business', true)[:2].upper() }}
                </div>
                {% endif %}
                
                <div class="business-rating">
                    <span class="stars">
                        {% for i in range(5) %}
                        <i class="fas fa-star {% if i < ((business.rating|default(0))|round|int) %}filled{% endif %}"></i>
                        {% endfor %}
                    </span>
                    <span class="rating-count">({{ business.review_count|default(0) }})</span>
                </div>
            </div>

            <div class="business-content">
                <h3>{{ business.name|default('Unnamed Business', true) }}</h3>
                <p class="category"><i class="fas fa-tag"></i> {{ business.category|default('Uncategorized', true) }}</p>
                <p class="location"><i class="fas fa-map-marker-alt"></i> {{ business.location|default('Location not specified', true) }}</p>
                <p class="description">{{ (business.description|default('No description available', true))[:150] }}...</p>

                {% if business.verified|default(false) %}
                <span class="verified-badge">
                    <i class="fas fa-check-circle"></i> Verified
                </span>
                {% endif %}

                <div class="business-meta">
                    {% if business.website|default('') %}
                    <a href="{{ business.website }}" target="_blank" class="meta-link">
                        <i class="fas fa-globe"></i>
                    </a>
                    {% endif %}
                    
                    {% if business.phone|default('') %}
                    <a href="tel:{{ business.phone }}" class="meta-link">
                        <i class="fas fa-phone"></i>
                    </a>
                    {% endif %}
                    
                    {% if business.email|default('') %}
                    <a href="mailto:{{ business.email }}" class="meta-link">
                        <i class="fas fa-envelope"></i>
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="business-footer">
                <a href="{{ url_for('guest.view_business_details', business_id=business.id) }}" 
                   class="btn btn-primary">View Details</a>
            </div>
        </div>
        {% endfor %}
        {% if businesses|length == 0 %}
        <div class="no-results">
            <p>No businesses found.</p>
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
    .businesses-container {
        padding: 20px;
    }

    .search-filter-container {
        margin-bottom: 20px;
    }

    .search-form {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .businesses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .business-card {
        background: var(--glass-bg);
        border-radius: 10px;
        padding: 20px;
        box-shadow: var(--glass-shadow);
        transition: transform 0.2s;
    }

    .business-card:hover {
        transform: translateY(-5px);
    }

    .business-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .business-logo, .business-logo-placeholder {
        width: 80px;
        height: 80px;
        border-radius: 10px;
        object-fit: cover;
    }

    .business-logo-placeholder {
        background: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: bold;
    }

    .business-rating {
        text-align: right;
    }

    .stars {
        color: #ffd700;
    }

    .stars .fa-star:not(.filled) {
        color: #ddd;
    }

    .rating-count {
        font-size: 0.8em;
        color: var(--text-muted);
    }

    .business-content {
        margin-bottom: 15px;
    }

    .business-content h3 {
        margin: 0 0 10px 0;
        color: var(--primary-color);
    }

    .category, .location {
        color: var(--text-muted);
        font-size: 0.9em;
        margin: 5px 0;
    }

    .description {
        margin: 10px 0;
        font-size: 0.9em;
        line-height: 1.5;
    }

    .verified-badge {
        display: inline-block;
        padding: 5px 10px;
        background: var(--success-color);
        color: white;
        border-radius: 15px;
        font-size: 0.8em;
        margin: 10px 0;
    }

    .business-meta {
        display: flex;
        gap: 15px;
        margin-top: 15px;
    }

    .meta-link {
        color: var(--primary-color);
        text-decoration: none;
    }

    .meta-link:hover {
        color: var(--primary-color-dark);
    }

    .business-footer {
        margin-top: 15px;
        text-align: right;
    }

    .view-toggle {
        margin: 20px 0;
        text-align: right;
    }

    .pagination {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    .current-page {
        padding: 5px 10px;
        background: var(--glass-bg);
        border-radius: 5px;
    }

    @media (max-width: 768px) {
        .search-form {
            flex-direction: column;
        }

        .search-form > * {
            width: 100%;
        }

        .business-header {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .business-rating {
            margin-top: 10px;
            text-align: center;
        }

        .business-meta {
            justify-content: center;
        }
    }
</style>
{% endblock %}